<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>POM Flip ‚Äî Telegram</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg:#0b0f1a; --card:#121830; --ink:#e8f1ff; --muted:#a9b8ff;
    --accent:#6ee3ff; --accent2:#4effa3; --ok:#0fd17b; --warn:#ffb65e;
    --btn:#1b2243; --btn2:#16203c;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:var(--bg); color:var(--ink); display:flex; align-items:center; justify-content:center;
    padding:16px; -webkit-tap-highlight-color: transparent;
  }
  .wrap{ width:100%; max-width:420px; }
  .head{
    text-align:center; margin-bottom:10px;
  }
  .title{ font-weight:800; font-size:18px; letter-spacing:.2px; }
  .sub{ color:var(--muted); font-size:13px; margin-top:4px; }
  .card{
    background:var(--card); border:1px solid rgba(110,227,255,.15);
    border-radius:16px; padding:14px 14px 12px;
  }

  /* Coin minimal */
  .stage{ perspective:1000px; display:flex; justify-content:center; margin:6px 0 10px; }
  .coin{
    width:132px; height:132px; border-radius:50%;
    position:relative; transform-style:preserve-3d;
    background: radial-gradient(65% 50% at 50% 35%, #1d2752 0%, #0f1531 70%);
    box-shadow: inset 0 0 18px rgba(255,255,255,.06), 0 10px 28px rgba(0,0,0,.35);
    border:1px solid rgba(110,227,255,.25);
    transition: transform 900ms cubic-bezier(.22,.8,.2,1);
  }
  .coin::before{ content:""; position:absolute; inset:8px; border-radius:50%; border:1px dashed rgba(110,227,255,.25); }
  .face{ position:absolute; inset:0; display:grid; place-items:center; font-size:44px; backface-visibility:hidden; user-select:none; }
  .front{ transform: translateZ(2px); }
  .back { transform: rotateY(180deg) translateZ(2px); }

  .buttons{ display:grid; gap:10px; margin-top:8px; }
  button{
    height:54px; border:none; border-radius:12px; font-weight:800; font-size:16px; letter-spacing:.2px;
    background:var(--btn); color:#eaf3ff; box-shadow:0 6px 16px rgba(0,0,0,.24);
    display:flex; align-items:center; justify-content:center; gap:8px; cursor:pointer;
  }
  .b2{ background:var(--btn2); }
  button:active{ transform:translateY(1px) }
  button[disabled]{ opacity:.6; cursor:not-allowed; }

  .info{
    margin-top:10px; display:flex; justify-content:space-between; font-size:13px; color:var(--muted);
  }
  .toast{
    position:fixed; left:16px; right:16px; bottom: max(16px, env(safe-area-inset-bottom));
    background:#0e1430; color:#dff6ff; border:1px solid rgba(110,227,255,.18);
    border-radius:12px; padding:10px 12px; font-weight:700; text-align:center; opacity:0; transform:translateY(8px);
    transition:opacity .18s ease, transform .18s ease;
  }
  .toast.show{ opacity:1; transform:translateY(0) }
  .ok{ color:var(--ok) } .warn{ color:var(--warn) }
  footer{ margin-top:10px; text-align:center; color:var(--muted); font-size:12px; opacity:.9 }
</style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div class="title">POM Flip</div>
      <div class="sub">Heads = Bark üêï ¬∑ Tails = Bite ü¶¥</div>
    </div>

    <div class="card">
      <div class="stage">
        <div id="coin" class="coin">
          <div class="face front" aria-label="Heads">üêï</div>
          <div class="face back" aria-label="Tails">ü¶¥</div>
        </div>
      </div>

      <div class="buttons">
        <button id="btnH">Heads (Bark üêï)</button>
        <button id="btnT" class="b2">Tails (Bite ü¶¥)</button>
      </div>

      <div class="info">
        <div id="score">Score: 0</div>
        <div id="streak">Streak: 0 üî•</div>
      </div>
    </div>

    <footer>Designed for Telegram ‚Ä¢ fast, readable, simple</footer>
  </div>

  <div id="toast" class="toast">‚Äî</div>

<script>
  // Telegram integration (theme + haptics)
  const tg = window.Telegram?.WebApp;
  if (tg){ tg.ready(); tg.expand(); }
  const haptic = (t='light')=>{ try{ tg?.HapticFeedback?.impactOccurred(t) }catch(e){} };

  // Elements
  const coin = document.getElementById('coin');
  const btnH = document.getElementById('btnH');
  const btnT = document.getElementById('btnT');
  const scoreEl = document.getElementById('score');
  const streakEl = document.getElementById('streak');
  const toast = document.getElementById('toast');

  // State (local)
  let score = parseInt(localStorage.getItem('pomflip_score')||'0',10);
  let day = localStorage.getItem('pomflip_day')||'';
  let streak = parseInt(localStorage.getItem('pomflip_streak')||'0',10);
  let busy = false;

  const today = (()=>{ const d=new Date(); return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; })();

  function hud(){
    scoreEl.textContent = `Score: ${score}`;
    streakEl.textContent = `Streak: ${streak} üî•`;
    localStorage.setItem('pomflip_score', String(score));
    localStorage.setItem('pomflip_streak', String(streak));
  }

  // Daily bonus minimal (1 pt / jour)
  if (day !== today){
    streak = day ? streak+1 : 1;
    day = today; localStorage.setItem('pomflip_day', today);
    score += 1; // bonus tr√®s l√©ger
    toastMsg(`üéÅ Bonus quotidien +1 pt (streak ${streak})`);
  }
  hud();

  function toastMsg(txt, cls=''){
    toast.className = `toast ${cls} show`;
    toast.textContent = txt;
    setTimeout(()=>{ toast.classList.remove('show') }, 1200);
  }

  function setBusy(v){ busy=v; btnH.disabled=v; btnT.disabled=v; }

  function spin(final){ // final: 'heads'|'tails'
    const turns = 2 + Math.floor(Math.random()*2); // 2..3 tours
    const tilt = (Math.random()*10 - 5);
    const end = final==='heads' ? `rotateY(${turns*180}deg) rotateZ(${tilt}deg)`
                                : `rotateY(${turns*180+180}deg) rotateZ(${tilt}deg)`;
    coin.style.transition = 'transform 900ms cubic-bezier(.22,.8,.2,1)';
    void coin.offsetWidth;
    coin.style.transform = end;
  }

  function flip(choice){
    if(busy) return;
    setBusy(true); haptic('light');

    const outcome = Math.random()<0.5 ? 'heads':'tails';
    spin(outcome);

    setTimeout(()=>{
      const win = (choice===outcome);
      if (win){
        score += 2;
        hud();
        haptic('medium');
        toastMsg(`${outcome==='heads'?'üü¶ HEADS':'üü© TAILS'} +2 pts`, 'ok');
      } else {
        toastMsg(`${outcome==='heads'?'üü¶ HEADS':'üü© TAILS'} perdu`, 'warn');
      }
      setTimeout(()=>setBusy(false), 250); // petit cooldown
    }, 930);
  }

  btnH.addEventListener('click', ()=>flip('heads'));
  btnT.addEventListener('click', ()=>flip('tails'));
</script>
</body>
</html>
